---
title: C语言实现状态机
date: 2021-12-01 10:57:56
tags:
---



C 语言实现状态机



<!--more-->



C 状态机

```c
typedef int (*funcptr)();
typedef funcptr (*ptrfuncptr)();

funcptr start(), stop();
funcptr state1(), state2(), state3();

void state_machine()
{
    ptrfuncptr state = start;
    
    while(state != stop)
    {
        state = (funcptr)(*start)();
    }
}

funcptr start()
{
    return (funcptr)state1;
}
```







状态机2

```c
struct functhunk{
    struct functhunk (*func)();
}

struct functhunk start(), stop();
struct functhunk state1(), state2(), state3();

void state_machine()
{
    struct functhunk state = {start};
    
    while(state.func != stop)
        state = (*state.func());
}

struct functhunk start()
{
    struct functhunk ret;
    ret.func = state1;
    return ret;
}

```



